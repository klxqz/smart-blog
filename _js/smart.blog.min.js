$(function(){var t=function(t,a,r){e(),$(".comment-form").find("input[name=parent]").val(a);var n=$(".comment-form").show().insertAfter(t).find("[name=text]").val("");r&&n.focus()},e=function(t){var e=$(".comment-form");e.find(".errormsg").remove(),e.find(".error").removeClass("error"),e.find(".wa-captcha-refresh").click(),t&&e.find("textarea").val("")};$(".comment-reply").live("click",function(){var e=$(this).parents(".comment"),a=e.length?parseInt($(e).attr("id").replace(/^[\D]+/,"")):0;return t($(this).parent(),a,!0),!1}),$(".comment-form input:submit").click(function(){var a=$(this);a.attr("disabled",!0).next().show();var r=$(".comment-form"),n=$(".comment-form form");return $.post(n.attr("action")+"?json=1",n.serialize(),function(n){if(a.attr("disabled",!1).next().hide(),n.status&&"ok"==n.status&&n.data.redirect)return window.location.replace(n.data.redirect),void(window.location.href=n.data.redirect);if(n.status&&"ok"==n.status&&n.data){var o,i=$(n.data.template),s=n.data.count_str;r.prev().is(".comments")?o=r.prev(".comments").children("ul"):(o=r.parent(),o.next("ul").size()||o.after('<ul class="menu-v with-icons"></ul>'),o=o.next("ul")),o.append($("<li />").append(i)),t(".comments",0),$(".not-comment").remove(),$(".comment-count").show().html(s),i.trigger("plugin.comment_add"),e(!0)}else if(n.status&&"fail"==n.status){e();var m=n.errors;$(m).each(function(t){var e=this;for(name in e){var a=$(".comment-form form").find("[name="+name+"]");a.after($('<em class="errormsg"></em>').text(e[name])).addClass("error")}})}else e(!1)},"json").error(function(){e(!1)}),!1});var a="guest",r=$("ul#user-auth-provider li.selected");r.length?a=r.attr("data-provider")||a:(r=$("#user-auth-provider"),r.length&&(a=r.attr("data-provider")||a)),a&&($(".tab").hide(),"signup"==a?$(".comment-submit, .comment-body").hide():$(".comment-submit, .comment-body").show(),$("div.tab[data-provider='"+a+"']").show(),$("input[name=auth_provider]").val(a),"guest"==a?$(".wa-captcha").show():$(".wa-captcha").hide()),$("ul#user-auth-provider li.selected a, ul#user-auth-provider li:eq(0) a").click(function(){if($(this).parent().hasClass("selected"))return!1;var t=$(this).parent().attr("data-provider");return $(this).parent().addClass("selected").siblings().removeClass("selected"),$(".tab").hide(),$("div.tab[data-provider='"+t+"']").show(),"guest"==t?$(".wa-captcha").show():$(".wa-captcha").hide(),"signup"==t?$(".comment-submit, .comment-body").hide():$(".comment-submit, .comment-body").show(),$("input[name=auth_provider]").val(t),!1})});